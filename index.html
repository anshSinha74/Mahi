<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For My Love, Mahi ‚ù§Ô∏è</title>
    <style>
        :root {
            --primary: #FF3366; /* Passionate Red */
            --secondary: #FF6B8B; /* Soft Pink */
            --accent: #FFD700; /* Gold */
            --bg-gradient-start: #FFF0F5; /* Lavender Blush */
            --bg-gradient-end: #FFC0CB; /* Pink */
            --card-back: #FF1493; /* Deep Pink */
            --text-color: #8B0000; /* Dark Red text */
        }

        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Nunito:wght@400;700&display=swap');

        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            font-family: 'Nunito', sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--text-color);
        }

        /* --- Background Decorations --- */
        .decorations-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }

        .floating-item {
            position: absolute;
            bottom: -100px;
            font-size: 2rem;
            opacity: 0.6;
            animation: floatUp 15s linear infinite;
        }

        /* Heart Balloon CSS */
        .heart-balloon {
            position: absolute;
            width: 30px;
            height: 30px;
            background: var(--primary);
            transform: rotate(45deg);
            opacity: 0.7;
            animation: floatUp 15s linear infinite;
        }
        .heart-balloon::before, .heart-balloon::after {
            content: '';
            width: 30px;
            height: 30px;
            background: var(--primary);
            border-radius: 50%;
            position: absolute;
        }
        .heart-balloon::before { left: -15px; }
        .heart-balloon::after { top: -15px; }
        
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg) scale(1); }
            50% { transform: translateY(-60vh) rotate(10deg) scale(1.1); }
            100% { transform: translateY(-120vh) rotate(-10deg) scale(1); }
        }
        
        @keyframes rainDown {
            0% { transform: translateY(-100px); opacity: 1; }
            100% { transform: translateY(110vh); opacity: 0; }
        }

        /* --- UI Header --- */
        header {
            text-align: center;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            width: 90%;
            max-width: 800px;
            border-radius: 0 0 50px 50px;
            box-shadow: 0 10px 25px rgba(255, 51, 102, 0.2);
            margin-bottom: 20px;
            position: relative;
            z-index: 10;
            border-top: 5px solid var(--primary);
        }

        h1 {
            font-family: 'Dancing Script', cursive;
            color: var(--primary);
            margin: 0;
            font-size: 3.5rem;
            text-shadow: 2px 2px 2px rgba(255,255,255,0.8);
        }

        .subtitle {
            font-family: 'Dancing Script', cursive;
            font-size: 1.5rem;
            color: var(--secondary);
            margin-top: -10px;
            margin-bottom: 10px;
        }

        .status-bar {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .timer-box {
            background: #fff;
            color: var(--primary);
            padding: 8px 20px;
            border-radius: 20px;
            border: 2px solid var(--secondary);
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .controls {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 50px;
            font-family: 'Nunito', sans-serif;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(255, 107, 139, 0.3);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(255, 107, 139, 0.5);
        }

        button.music-btn {
            background: var(--primary);
        }
        
        button.magic-btn {
            background: linear-gradient(45deg, #FF69B4, #DA70D6);
            border: 2px solid #fff;
        }

        /* --- Game Grid --- */
        .game-container {
            perspective: 1000px;
            padding: 20px;
            width: 100%;
            max-width: 900px;
            display: flex;
            justify-content: center;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 800px;
        }

        @media (max-width: 768px) {
            .grid {
                grid-template-columns: repeat(5, 1fr);
                gap: 8px;
            }
            h1 { font-size: 2.5rem; }
        }
        @media (max-width: 480px) {
            .grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* --- Card Styles --- */
        .card {
            background-color: transparent;
            width: 100%;
            aspect-ratio: 3/4;
            perspective: 1000px;
            cursor: pointer;
            position: relative;
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1);
            transform-style: preserve-3d;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .card.flipped .card-inner {
            transform: rotateY(180deg);
        }

        .card.matched .card-inner {
            transform: rotateY(180deg) scale(0.95);
            box-shadow: 0 0 15px var(--secondary), 0 0 30px var(--primary);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border: 3px solid #fff;
            box-sizing: border-box;
            user-select: none;
            overflow: hidden; /* Important for images */
        }

        .card-front {
            background: white;
            transform: rotateY(180deg);
            padding: 0; /* Remove padding for image */
        }

        .card-front img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .card-back {
            background: linear-gradient(45deg, #ff9a9e 0%, #fecfef 99%, #fecfef 100%);
            color: var(--primary);
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .card-back::after {
            content: '‚ù§Ô∏è';
            font-size: 2.5rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.1));
        }

        @media (max-width: 600px) {
            .card-face { font-size: 1.5rem; }
            .card-back::after { font-size: 1.5rem; }
        }

        /* --- Glitter/Confetti --- */
        .confetti-container {
            position: absolute;
            pointer-events: none;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 100;
        }

        .glitter-particle {
            position: absolute;
            width: 15px;
            height: 15px;
            background: var(--primary);
            mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            -webkit-mask-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath d='M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z'/%3E%3C/svg%3E");
            mask-size: contain;
            -webkit-mask-size: contain;
            background-color: var(--primary);
            animation: popFade 1.2s forwards ease-out;
        }
        
        /* Fallback for mask support */
        @supports not (mask-image: url()) {
            .glitter-particle {
                border-radius: 50%;
                background: var(--primary);
            }
        }

        @keyframes popFade {
            0% { transform: translate(0, 0) scale(1) rotate(0deg); opacity: 1; }
            100% { transform: translate(var(--tx), var(--ty)) scale(0) rotate(180deg); opacity: 0; }
        }

        /* --- Overlays --- */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 240, 245, 0.95);
            z-index: 200;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(8px);
            transition: opacity 0.5s;
        }

        .modal.hidden {
            display: none;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 30px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(255, 51, 102, 0.2);
            border: 4px solid var(--primary);
            max-width: 90%;
            width: 450px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }
        
        .modal-content::before {
            content: 'üíñ';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 3rem;
            background: white;
            border-radius: 50%;
            padding: 0 10px;
        }

        .modal h2 {
            font-family: 'Dancing Script', cursive;
            color: var(--primary);
            font-size: 3rem;
            margin-bottom: 20px;
            margin-top: 10px;
        }

        .big-btn {
            font-size: 1.3rem;
            padding: 15px 40px;
            margin-top: 20px;
            background: var(--primary);
        }

        /* --- Love Note / Gemini Styles --- */
        .gemini-box {
            background-color: #FFF5F7;
            border: 2px dashed var(--secondary);
            padding: 20px;
            border-radius: 20px;
            margin-bottom: 20px;
            font-size: 1.1rem;
            color: #555;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Dancing Script', cursive;
            font-weight: bold;
            font-size: 1.5rem;
            color: #C71585;
        }

        .pickup-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: white;
            padding: 15px 30px;
            border-radius: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 2px solid var(--primary);
            z-index: 150;
            font-family: 'Dancing Script', cursive;
            font-size: 1.4rem;
            color: var(--primary);
            width: 80%;
            max-width: 500px;
            text-align: center;
            transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        .pickup-toast.show {
            transform: translateX(-50%) translateY(0);
        }

        .loading-pulse {
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }
        
        .cry-particle {
            position: absolute;
            font-size: 2rem;
            animation: rainDown 3s linear forwards;
        }

    </style>
</head>
<body>

    <!-- Background Decoration -->
    <div class="decorations-container" id="decorations"></div>
    
    <!-- Pickup Line Toast -->
    <div id="pickupToast" class="pickup-toast">
        üíñ Lovely match!
    </div>

    <!-- UI Header -->
    <header>
        <h1>For My Love, Mahi ‚ù§Ô∏è</h1>
        <div class="subtitle">A little game by Ansh</div>
        <div class="status-bar">
            <div class="timer-box">
                <span>‚è∞</span>
                <span id="timer">15:00</span>
            </div>
            <div class="moves-box">
                <span>Moves: <span id="moves">0</span></span>
            </div>
        </div>
        <div class="controls">
            <button class="music-btn" onclick="toggleMusic()">üéµ Love Song: Off</button>
            <button onclick="resetGame()">üîÑ Restart</button>
            <button class="magic-btn" onclick="askForCompliment()">‚ú® Compliment Mahi</button>
        </div>
    </header>

    <!-- Game Board -->
    <div class="game-container">
        <div class="grid" id="grid"></div>
    </div>

    <!-- Modals -->
    <div id="startModal" class="modal">
        <div class="modal-content">
            <h2>Hi Mahi! ‚ù§Ô∏è</h2>
            <p>I made this special game just for you.<br>Match our photos to find out how much I love you.</p>
            <button class="big-btn" onclick="initGame()">‚ñ∂Ô∏è Play My Love</button>
        </div>
    </div>

    <div id="winModal" class="modal hidden">
        <div class="modal-content">
            <h2>You Won, My Queen! üëë</h2>
            <div id="story-container" class="gemini-box">
                <span class="loading-pulse">‚ú® Ansh is writing a love letter...</span>
            </div>
            <button class="big-btn" onclick="resetGame()">Play Again Babe?</button>
        </div>
    </div>

    <div id="loseModal" class="modal hidden">
        <div class="modal-content" style="border-color: #4a90e2;">
            <h2 style="color: #4a90e2;">Babe you don't love me? üò≠</h2>
            <p>The time ran out... but my love for you never will.</p>
            <button class="big-btn" style="background: #4a90e2;" onclick="resetGame()">Try Again Please</button>
        </div>
    </div>

    <div id="riddleModal" class="modal hidden">
        <div class="modal-content">
            <h2>‚ú® For Beautiful Mahi ‚ú®</h2>
            <div id="riddle-container" class="gemini-box">
                 <span class="loading-pulse">‚ú® Thinking of your beauty...</span>
            </div>
            <button class="big-btn" onclick="closeRiddle()">Blushing... ü•∞</button>
        </div>
    </div>

    <!-- Sound & Game Logic -->
    <script>
        const apiKey = "AIzaSyCdWVwTwjDXL-BYANReUdE2AlSGdQwSk5M"; 

        // --- ANSH: PASTE YOUR IMAGE LINKS HERE ---
        // Replace these placeholder links with the URLs of your photos.
        const IMAGE_URLS = [
            'https://placehold.co/300x400/FF6B8B/ffffff?text=Mahi+1',
            'https://placehold.co/300x400/FF3366/ffffff?text=Us+2',
            'https://placehold.co/300x400/FFD700/8B0000?text=Love+3',
            'https://placehold.co/300x400/FF69B4/ffffff?text=Date+4',
            'https://placehold.co/300x400/87CEEB/ffffff?text=Smile+5',
            'https://placehold.co/300x400/98FB98/006400?text=Hug+6',
            'https://placehold.co/300x400/DDA0DD/4B0082?text=Trip+7',
            'https://placehold.co/300x400/FFA07A/8B0000?text=Kiss+8',
            'https://placehold.co/300x400/20B2AA/ffffff?text=Cute+9',
            'https://placehold.co/300x400/FF6347/ffffff?text=Heart+10',
            'https://placehold.co/300x400/40E0D0/ffffff?text=Mahi+11',
            'https://placehold.co/300x400/EE82EE/4B0082?text=Sweet+12',
            'https://placehold.co/300x400/F0E68C/556B2F?text=Fun+13',
            'https://placehold.co/300x400/B0C4DE/00008B?text=Eyes+14',
            'https://placehold.co/300x400/FFB6C1/C71585?text=Forever+15'
        ];

        async function callGemini(prompt) {
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Gemini Error:", error);
                return "You are the most beautiful girl in the world, Mahi!";
            }
        }

        async function askForCompliment() {
            if (!gameActive) return;
            const modal = document.getElementById('riddleModal');
            const container = document.getElementById('riddle-container');
            modal.classList.remove('hidden');
            container.innerHTML = '<span class="loading-pulse">‚ú® Thinking of your beauty...</span>';
            const prompt = `Write a short, poetic, and extremely romantic compliment for a beautiful girl named Mahi from her boyfriend Ansh. Focus on her smile or eyes. Keep it under 20 words.`;
            const compliment = await callGemini(prompt);
            container.innerText = compliment;
        }

        function closeRiddle() {
            document.getElementById('riddleModal').classList.add('hidden');
        }

        async function generateWinMessage() {
            const container = document.getElementById('story-container');
            container.innerHTML = '<span class="loading-pulse">‚ú® Ansh is writing a love letter...</span>';
            const prompt = `Write a heartfelt, romantic short paragraph (max 40 words) from Ansh to his girlfriend Mahi. Tell her she won the game, but he won the lottery by having her. Express deep care and love.`;
            const message = await callGemini(prompt);
            container.innerText = message;
        }
        
        async function getPickupLine() {
            const toast = document.getElementById('pickupToast');
            const prompt = `Write a cute, cheesy, blushing romantic pickup line for my girlfriend. Max 10 words. No hashtags.`;
            callGemini(prompt).then(text => {
                toast.innerText = "üíñ " + text;
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 4000);
            });
        }

        // --- Game Config ---
        const GAME_DURATION_MINUTES = 15;

        // --- State ---
        let cards = [];
        let flippedCards = [];
        let matchedPairs = 0;
        let moves = 0;
        let timerInterval;
        let timeLeft = GAME_DURATION_MINUTES * 60;
        let gameActive = false;
        let isMusicPlaying = false;

        // --- DOM Elements ---
        const grid = document.getElementById('grid');
        const timerDisplay = document.getElementById('timer');
        const movesDisplay = document.getElementById('moves');
        const startModal = document.getElementById('startModal');
        const winModal = document.getElementById('winModal');
        const loseModal = document.getElementById('loseModal');
        const musicBtn = document.querySelector('.music-btn');
        const decorations = document.getElementById('decorations');

        // --- Audio System ---
        class AudioSynth {
            constructor() {
                this.ctx = null;
                this.bgmInterval = null;
            }
            init() {
                if (!this.ctx) {
                    this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                }
            }
            playTone(freq, type, duration, vol = 0.1) {
                if (!this.ctx) return;
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, this.ctx.currentTime);
                gain.gain.setValueAtTime(vol, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.001, this.ctx.currentTime + duration);
                osc.connect(gain);
                gain.connect(this.ctx.destination);
                osc.start();
                osc.stop(this.ctx.currentTime + duration);
            }
            playPop() {
                this.init();
                if(this.ctx.state === 'suspended') this.ctx.resume();
                this.playTone(440, 'sine', 0.5, 0.05);
            }
            playMatch() {
                this.init();
                [523.25, 659.25, 783.99, 1046.50, 1318.51].forEach((freq, i) => {
                    setTimeout(() => this.playTone(freq, 'sine', 1.0, 0.03), i * 150);
                });
            }
            startMusic() {
                this.init();
                if (this.bgmInterval) return;
                const melody = [261, 329, 392, 523, 392, 329, 196, 246, 293, 392, 293, 246, 220, 261, 329, 440, 329, 261, 174, 220, 261, 349, 261, 220];
                let noteIndex = 0;
                this.bgmInterval = setInterval(() => {
                    const note = melody[noteIndex];
                    this.playTone(note, 'sine', 1.5, 0.015);
                    noteIndex = (noteIndex + 1) % melody.length;
                }, 600);
            }
            stopMusic() {
                if (this.bgmInterval) {
                    clearInterval(this.bgmInterval);
                    this.bgmInterval = null;
                }
            }
        }

        const audio = new AudioSynth();

        // --- Visual Effects ---
        function createDecorations() {
            for(let i=0; i<8; i++) {
                const b = document.createElement('div');
                b.className = 'heart-balloon';
                b.style.left = Math.random() * 100 + '%';
                b.style.animationDelay = (Math.random() * 10) + 's';
                b.style.animationDuration = (20 + Math.random() * 10) + 's';
                decorations.appendChild(b);
            }
            for(let i=0; i<6; i++) {
                const t = document.createElement('div');
                t.className = 'floating-item';
                t.textContent = 'üß∏';
                t.style.left = Math.random() * 100 + '%';
                t.style.animationDelay = (Math.random() * 5) + 's';
                t.style.animationDuration = (25 + Math.random() * 10) + 's';
                decorations.appendChild(t);
            }
             for(let i=0; i<6; i++) {
                const k = document.createElement('div');
                k.className = 'floating-item';
                k.textContent = 'üíã';
                k.style.left = Math.random() * 100 + '%';
                k.style.animationDelay = (Math.random() * 8) + 's';
                k.style.animationDuration = (18 + Math.random() * 10) + 's';
                decorations.appendChild(k);
            }
        }
        
        function triggerRain() {
            const container = document.body;
            for(let i=0; i<50; i++) {
                const d = document.createElement('div');
                d.className = 'cry-particle';
                d.textContent = 'üò≠';
                d.style.left = Math.random() * 100 + 'vw';
                d.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(d);
            }
        }

        function spawnGlitter(x, y) {
            const container = document.body;
            for(let i=0; i<20; i++) {
                const p = document.createElement('div');
                p.className = 'glitter-particle';
                p.style.left = x + 'px';
                p.style.top = y + 'px';
                const tx = (Math.random() - 0.5) * 200;
                const ty = (Math.random() - 0.5) * 200;
                p.style.setProperty('--tx', `${tx}px`);
                p.style.setProperty('--ty', `${ty}px`);
                container.appendChild(p);
                setTimeout(() => p.remove(), 1200);
            }
        }

        // --- Game Logic ---
        function formatTime(seconds) {
            const m = Math.floor(seconds / 60);
            const s = seconds % 60;
            return `${m}:${s < 10 ? '0' : ''}${s}`;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function initGame() {
            audio.init();
            startModal.classList.add('hidden');
            winModal.classList.add('hidden');
            loseModal.classList.add('hidden');
            
            // Create pairs from the Image URLs
            const deck = [...IMAGE_URLS, ...IMAGE_URLS];
            shuffle(deck);
            
            grid.innerHTML = '';
            cards = [];
            
            deck.forEach((imgUrl, index) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.value = imgUrl; // Match based on URL
                card.dataset.index = index;
                
                const inner = document.createElement('div');
                inner.className = 'card-inner';
                
                const front = document.createElement('div');
                front.className = 'card-face card-front';
                // Insert Image instead of text
                const img = document.createElement('img');
                img.src = imgUrl;
                img.alt = "Memory Card";
                front.appendChild(img);
                
                const back = document.createElement('div');
                back.className = 'card-face card-back';
                
                inner.appendChild(front);
                inner.appendChild(back);
                card.appendChild(inner);
                
                card.addEventListener('click', handleCardClick);
                grid.appendChild(card);
                cards.push(card);
            });

            matchedPairs = 0;
            moves = 0;
            movesDisplay.textContent = moves;
            timeLeft = GAME_DURATION_MINUTES * 60;
            timerDisplay.textContent = formatTime(timeLeft);
            gameActive = true;
            flippedCards = [];
            
            document.querySelectorAll('.cry-particle').forEach(el => el.remove());

            if (timerInterval) clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                timeLeft--;
                timerDisplay.textContent = formatTime(timeLeft);
                if (timeLeft <= 0) {
                    endGame(false);
                }
            }, 1000);

            if(isMusicPlaying) audio.startMusic();
            else audio.playTone(0, 'sine', 0.01, 0); 
        }

        function handleCardClick(e) {
            if (!gameActive) return;
            const card = e.currentTarget;
            if (card.classList.contains('flipped') || card.classList.contains('matched')) return;
            if (flippedCards.length >= 2) return;

            audio.playPop();
            card.classList.add('flipped');
            flippedCards.push(card);

            if (flippedCards.length === 2) {
                moves++;
                movesDisplay.textContent = moves;
                checkMatch();
            }
        }

        function checkMatch() {
            const [c1, c2] = flippedCards;
            const match = c1.dataset.value === c2.dataset.value;

            if (match) {
                matchedPairs++;
                const rect1 = c1.getBoundingClientRect();
                const rect2 = c2.getBoundingClientRect();
                
                setTimeout(() => {
                    audio.playMatch();
                    c1.classList.add('matched');
                    c2.classList.add('matched');
                    spawnGlitter(rect1.left + rect1.width/2, rect1.top + rect1.height/2);
                    spawnGlitter(rect2.left + rect2.width/2, rect2.top + rect2.height/2);
                    flippedCards = [];
                    getPickupLine();
                    
                    if (matchedPairs === IMAGE_URLS.length) {
                        endGame(true);
                    }
                }, 500);

            } else {
                setTimeout(() => {
                    c1.classList.remove('flipped');
                    c2.classList.remove('flipped');
                    flippedCards = [];
                }, 1000);
            }
        }

        function endGame(win) {
            gameActive = false;
            clearInterval(timerInterval);
            if (win) {
                audio.playMatch();
                setTimeout(() => {
                    winModal.classList.remove('hidden');
                    for(let i=0; i<5; i++) {
                        setTimeout(() => spawnGlitter(window.innerWidth/2, window.innerHeight/2), i*200);
                    }
                    generateWinMessage(); 
                }, 500);
            } else {
                loseModal.classList.remove('hidden');
                triggerRain();
            }
        }

        function resetGame() {
            initGame();
        }

        function toggleMusic() {
            isMusicPlaying = !isMusicPlaying;
            if (isMusicPlaying) {
                audio.startMusic();
                musicBtn.textContent = "üéµ Love Song: On";
            } else {
                audio.stopMusic();
                musicBtn.textContent = "üéµ Love Song: Off";
            }
        }

        createDecorations();
    </script>
</body>

</html>

